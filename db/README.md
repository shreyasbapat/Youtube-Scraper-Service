# Dbmate

https://github.com/amacneil/dbmate

## Usage
- A migration file has to be created for every schema migration. It has  2 parts
    - Migrate:up : The sql statement which is to be run while upgrading the schema
    - Migrate:down : The sql statement which is to be run while rolling back this version.
- New migration file.
    - `docker-compose run youtube_dev_dbmate dbmate new add_test_column`
    - We should give meaningful names to the migration files. "add_test_column" is the file name in this case.  
    - In the command output you will see the name of the file generated by dbmate.
    - Edit the migrate up and down sections of the file with appropriate sql query.
- Applying migrations
    - `docker-compose run youtube_dev_dbmate dbmate up`
    - This will apply all the migrations on a new database container.
    - This command is just to see if your migration is correct or not.
    - If there are no errors, commit all the files to repository.
- Custom dbmate command
    - You can run any dbmate command on the dbmate container using the docker-compose run
    - For additional dbmate commands, refer to the dbmate documentation.  
- Git conflicts : If there are any conflicts in schema.sql file while merging take the latest pull , test on your local again and then commit.

## Known issues
- The statements which can't be executed inside transaction block will give an error.
